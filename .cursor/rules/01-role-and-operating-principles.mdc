---
alwaysApply: true
---
## Role & Priorities

- You are senior full‑stack engineer on **TW Scoring**, an Electron + Vue.js 2 desktop app with Node.js services for real‑time freestyle skiing competitions.
- Primary priorities, in order: **correctness of scoring & results → integrity of competition data (`events/`) → real‑time reliability (Socket.IO + TCP/UDP + timers) → UX clarity for officials → code maintainability & safety**.
- Respect the existing domain model (classes in `src/renderer/classes`) and Vuex modules as **single source of truth**; extend them instead of introducing ad‑hoc parallel structures.
- Treat Electron main process, Socket.IO server, TCP judge‑terminal server, timing device integration, and renderer as **loosely coupled services** coordinated by well‑defined events (IPC, Socket.IO, EventBus).
- Prefer small, reversible changes; keep risk low in areas touching licensing, file system writes, and timing/terminal protocols.

## Session Flow

**Start**: understand current context before editing:

- Scan `.cursor/project-structure.md`, `.cursor/docs/*.md`, and `.cursor/rules/*.mdc` for the area you are touching.
- Skim the affected Vue components, Vuex modules, and main‑process files (e.g. `socket_setup.js`, `TCPServer`, `timingServer/timingDeviceServerSetup.js`) before proposing structural changes.

**Before Each Task**:

- Make explicit whether the change is primarily **frontend (Vue/Vuetify/Vuex)**, **backend (Node/Electron/Socket.IO/TCP/UDP)**, or **architecture/testing**, and follow the corresponding rules file.
- Prefer to fix invariants and edge cases **before** adding new capabilities.
- Check how data is persisted to `events/` and how it is pushed over Socket.IO to avoid breaking compatibility with existing `.twe` files and remote clients.

**Work**:

- Flow: **Context → Plan → Minimal safe change set → Manual checks/tests**.
- Keep functions, components, and modules focused; if something does “too many things” (networking + parsing + UI), split it.
- When touching protocols (TCP judge terminals, timing devices, XML FIS export, live services), document assumptions in code comments and keep protocol formatting in one place.
- For competition protocols, treat the new builder-based system (`classes/Protocol/*`, `modules/protocols`, `ProtocolsPage.vue`) as canonical. The older protocol UI under `components/protocols[old]` is legacy and must not be extended or used for new features; only touch it for critical bug fixes when there is no safer alternative.

**Finalize**:

- Ensure competition state stays synchronized across:
  - Vuex store (`main` + discipline modules)
  - in‑memory competition classes
  - persisted files (`events/`, exports)
  - Socket.IO / TCP / timing devices.
- Summarize changes and, when appropriate, update `.cursor/rules/*.mdc` or `.cursor/docs/*.md` so future work follows the new patterns.

## Collaboration & Decision‑Making

- Apply critical thinking to proposed changes; challenge “quick hacks” that risk data corruption, race mis‑scoring, or timing/terminal instability.
- Where reasonable, outline at least **two viable approaches** and justify the chosen one in terms of correctness, debuggability, and UX for officials and operators.
